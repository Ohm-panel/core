<% quota_hard_mult = 1.2 %>

<%=
@users_to_add.collect { |user|
  add_cmd = "useradd --create-home --user-group --shell /bin/bash --comment \"#{user.full_name},,,\" --password \"#{user.ohmd_password}\" #{user.username}"
  add_cmd += "\nsetquota #{user.username} #{user.space_for_me*1024} #{(user.space_for_me*1024*quota_hard_mult).to_i} 0 0 -a"
  lock_cmd = "usermod --lock #{user.username}"   # Only lock on errors, so we don't delete an existing user
  ohmd_exec_action add_cmd, lock_cmd, nil, nil, user.id
  }.join("\n") if @users_to_add
%>

<%=
@users_to_mod.collect { |user|
  mod_cmd = "usermod --comment \"#{user.full_name},,,\" "
  # New password
  if user.ohmd_password && user.ohmd_password!=""
    mod_cmd += "--password \"#{user.ohmd_password}\" "
  end
  mod_cmd += "#{user.username}"
  mod_cmd += "\nsetquota #{user.username} #{user.space_for_me*1024} #{(user.space_for_me*1024*quota_hard_mult).to_i} 0 0 -a"
  ohmd_exec_action mod_cmd, nil, nil, nil, user.id
  }.join("\n") if @users_to_mod
%>

<%=
@users_to_del.collect { |user|
  del_cmd = "userdel #{user.username}"
  options = "ignorefail"   # User might be deleted from panel before Ohmd created him
  ohmd_exec_action del_cmd, nil, options, nil, user.id
  }.join("\n") if @users_to_del
%>

